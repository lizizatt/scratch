#!/usr/bin/env python3

import time
from pynput import keyboard
import fluidsynth

# Initialize FluidSynth
fs = fluidsynth.Synth()
fs.start()
soundfont_path = "soundfont_sm64.sf2"  # Replace with the actual path to your SoundFont
sfid = fs.sfload(soundfont_path)
fs.program_select(0, sfid, 0, 0)

# Set up a dictionary to map keystrokes to MIDI notes
key_note_mapping = {
    '1': 60,  # Middle C
    '2': 62,  # D
    '3': 64,  # E
    '4': 65,  # F
    '5': 67,  # G
    '6': 69,  # A
    '7': 71,  # B
    '8': 72,  # High C
}

# Callback function to play a note when a key is pressed
def on_key_press(key):
    try:
        note = key_note_mapping[key.char]
        fs.noteon(0, note, 80)  # Play the note
        print("on {}".format(note))
    except KeyError:
        pass

# Callback function to stop playing the note when a key is released
def on_key_release(key):
    try:
        note = key_note_mapping[key.char]
        fs.noteoff(0, note)  # Stop playing the note
        print("off {}".format(note))
    except KeyError:
        pass

# Start monitoring keyboard events
listener = keyboard.Listener(on_press=on_key_press, on_release=on_key_release)
listener.start()

# Polling loop to keep the script running
try:
    while True:
        time.sleep(.1)
except KeyboardInterrupt:
    pass
finally:
    print("done")
    listener.stop()
    fs.delete()